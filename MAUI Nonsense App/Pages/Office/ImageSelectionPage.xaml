<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:helpers="clr-namespace:MAUI_Nonsense_App.Helpers"
             x:Class="MAUI_Nonsense_App.Pages.Office.ImageSelectionPage"
             Title="Select Images">

    <ContentPage.Resources>
        <ResourceDictionary>
            <helpers:GreaterThanZeroConverter x:Key="GreaterThanZeroConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto" Padding="20">

        <!-- Top Buttons -->
        <Grid Grid.Row="0" ColumnDefinitions="*,*"
              ColumnSpacing="10"
              Margin="0,0,0,10">
            <Button Text="Take Photo" Clicked="OnTakePhotoClicked" Grid.Column="0" />
            <Button Text="Pick from Gallery" Clicked="OnPickPhotosClicked" Grid.Column="1" />
        </Grid>

        <!-- Selected Images -->
        <StackLayout Grid.Row="1">
            <Label Text="Selected Images:" FontAttributes="Bold" Margin="0,0,0,5" />

            <CollectionView x:Name="SelectedImagesView"
                            ItemsSource="{Binding SelectedImages}"
                            VerticalOptions="FillAndExpand">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BorderColor="LightGray" CornerRadius="8" Padding="8" Margin="0,5">
                            <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="10">

                                <!-- Thumbnail -->
                                <Image Source="{Binding FilePath}"
                                       WidthRequest="60"
                                       HeightRequest="80"
                                       Aspect="AspectFill"
                                       Grid.RowSpan="3" />

                                <!-- Metadata -->
                                <Label Text="{Binding FileName}" FontAttributes="Bold" Grid.Column="1" Grid.Row="0" />
                                <Label Text="{Binding DisplayDate}" FontSize="12" TextColor="Gray" Grid.Column="1" Grid.Row="1" />
                                <Label Text="{Binding DisplaySize}" FontSize="12" TextColor="Gray" Grid.Column="1" Grid.Row="2" />

                                <!-- Delete -->
                                <Button Text="Delete"
                                        BackgroundColor="Tomato"
                                        TextColor="White"
                                        CommandParameter="{Binding}"
                                        Clicked="OnDeleteClicked"
                                        Grid.Column="2"
                                        Grid.RowSpan="3"
                                        VerticalOptions="Center" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </StackLayout>

        <!-- Bottom Buttons -->
        <Grid Grid.Row="2"
              ColumnDefinitions="*,*"
              ColumnSpacing="10"
              Margin="0,10,0,0">

            <Button Text="Back"
                    Clicked="OnBackClicked"
                    Grid.Column="0"
                    BackgroundColor="Gray"
                    TextColor="White"
                    CornerRadius="8"
                    HorizontalOptions="Fill" />

            <Button Text="Next"
                    Clicked="OnNextClicked"
                    Grid.Column="1"
                    IsEnabled="{Binding SelectedImages.Count, Converter={StaticResource GreaterThanZeroConverter}}"
                    BackgroundColor="#512BD4"
                    TextColor="White"
                    CornerRadius="8"
                    HorizontalOptions="Fill" />
        </Grid>
    </Grid>
</ContentPage>
